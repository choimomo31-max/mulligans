<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë©€ë¦¬ê±´ì¦ˆ ëŒ€íšŒ ìˆœìœ„í‘œ</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 10px;
}
h1, h2 { text-align: center; }
table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    margin-bottom: 20px;
    font-size: 14px;
}
th, td {
    border: 1px solid #ddd;
    padding: 6px;
    text-align: center;
}
th {
    background: #2c3e50;
    color: white;
}
input, select {
    width: 60px;
    padding: 4px;
    text-align: center;
}
button {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    font-size: 16px;
    background: #3498db;
    color: white;
    border: none;
}
input {
    font-size: 16px; /* iOS ìë™ í™•ëŒ€ ë°©ì§€ */
}
.button-area {
    display: flex;
    gap: 8px;
    margin: 10px 0;
}
.button-area button {
    flex: 1;
}
.rank-1 { background: #fff3cd; font-weight: bold; }
.rank-2 { background: #f1f1f1; }
.rank-3 { background: #fdf2e9; }
@media (max-width:600px) {
    table { font-size: 12px; }
    input { width: 40px; }
	select { width: 40px; }
}
</style>
</head>
<body>

<h1>ğŸŒï¸ ë©€ë¦¬ê±´ì¦ˆ ëŒ€íšŒ ìˆœìœ„í‘œ</h1>

<div class="button-area">
<button onclick="resetRound()">ğŸ”„ ëŒ€íšŒ ì´ˆê¸°í™”</button>
<button onclick="calculate()">ğŸ“Š ìˆœìœ„ ê³„ì‚°</button>
</div>

<table id="playerTable">
<thead>
<tr>
    <th>ìˆœìœ„</th>
    <th>íšŒì›ëª…</th>
    <th>íŒ€</th>
    <th>í•¸ë””</th>
    <th>ìŠ¤ì½”ì–´</th>
    <th>ë©€ë¦¬ê±´</th>
    <th>Net</th>
</tr>
</thead>
<tbody></tbody>
</table>

<h2>ğŸ† íŒ€ ìˆœìœ„</h2>
<table id="teamTable">
<thead>
<tr>
    <th>ìˆœìœ„</th>
    <th>íŒ€</th>
    <th>íŒ€ Net í•©ê³„</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const members = [
"ê³½ì •í›ˆ","ê¹€ê¸°íƒœ","ê¹€ë¬´ë˜","ê¹€ì¬ìš±","ê¹€ì¤€ìš°","ê¹€íƒœìš´","ê¹€íŒêµ","ëª…ë…¸ìš±",
"ë°•ìƒìš©","ë°•ìš°ë¯¼","ë°•ì² ìˆ˜","ì„œì„±í•˜","ì†¡í˜¸ì¤€","ì˜¤ì°¬ìš±","ì´ì •ì€","ì´ì¤€ì˜",
"ì „ì§„ìš©","ì§„ìƒë¬´","ìµœì˜ì§„","í™©ë„ì˜"
];

const storageKey = "golfzonTournamentData";

// ì´ˆê¸° í…Œì´ë¸” ìƒì„±
const tbody = document.querySelector("#playerTable tbody");
members.forEach((name, i) => {
    tbody.insertAdjacentHTML("beforeend", `
    <tr data-index="${i}">
        <td>-</td>
        <td>${name}</td>
        <td>
            <select>
                <option></option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option>
            </select>
        </td>
        <td><input type="text" inputmode="numeric" pattern="-?[0-9]*"></td>
        <td><input type="text" inputmode="numeric" pattern="-?[0-9]*"></td>
        <td><input type="text" inputmode="numeric" pattern="-?[0-9]*"></td>
        <td>-</td>
    </tr>
    `);
});

// ì €ì¥ ë¡œë“œ
loadData();

// ìë™ ì €ì¥ ì´ë²¤íŠ¸
document.querySelectorAll("input, select").forEach(el => {
    el.addEventListener("input", saveData);
});

function resetRound() {
    const ok = confirm("íŒ€, ìŠ¤ì½”ì–´, ë©€ë¦¬ê±´, Netì„ ì´ˆê¸°í™”í• ê¹Œìš”?\n(í•¸ë””ì™€ íšŒì›ëª…ì€ ìœ ì§€ë©ë‹ˆë‹¤)");

    if (!ok) return; // âŒ ì·¨ì†Œ ì‹œ ì•„ë¬´ ê²ƒë„ ì•ˆ í•¨

    const rows = [...tbody.rows];

    rows.forEach(r => {
        // íŒ€ ì´ˆê¸°í™”
        r.querySelector("select").value = "A";

        const inputs = r.querySelectorAll("input");

        // ìŠ¤ì½”ì–´ ì´ˆê¸°í™”
        inputs[1].value = "";

        // ë©€ë¦¬ê±´ ì´ˆê¸°í™”
        inputs[2].value = "";

        // ìˆœìœ„ / Net ì´ˆê¸°í™”
        r.cells[0].textContent = "-";
        r.cells[6].textContent = "-";

        // ìŠ¤íƒ€ì¼ ì œê±°
        r.className = "";
    });

    // íŒ€ ìˆœìœ„ ì´ˆê¸°í™”
    document.querySelector("#teamTable tbody").innerHTML = "";

    // ì €ì¥ ë°ì´í„° ë°˜ì˜
    saveData();
}

function saveData() {
    const data = [...tbody.rows].map(r => {
        const inputs = r.querySelectorAll("input");
        return {
            team: r.querySelector("select").value,
            handicap: inputs[0].value,
            score: inputs[1].value,
            mulligan: inputs[2].value
        };
    });
    localStorage.setItem(storageKey, JSON.stringify(data));
}

function loadData() {
    const data = JSON.parse(localStorage.getItem(storageKey) || "[]");
    data.forEach((d, i) => {
        const row = tbody.rows[i];
        if (!row) return;
        row.querySelector("select").value = d.team || "A";
        const inputs = row.querySelectorAll("input");
        inputs[0].value = d.handicap || "";
        inputs[1].value = d.score || "";
        inputs[2].value = d.mulligan || "";
    });
}

function calculate() {
    const rows = [...tbody.rows];
    const validPlayers = [];

    rows.forEach(r => {
        r.className = "";
        r.cells[0].textContent = "-";
        r.cells[6].textContent = "-";

        const inputs = r.querySelectorAll("input");
        const score = Number(inputs[1].value);

        // ğŸ‘‰ ìŠ¤ì½”ì–´ ì—†ìœ¼ë©´ ì œì™¸
        if (!score) return;

        const handicap = Number(inputs[0].value || 0);
        const mulligan = Number(inputs[2].value || 0);
        const net = score - handicap - mulligan;

        validPlayers.push({
            row: r,
            team: r.querySelector("select").value,
            net
        });
    });

    validPlayers.sort((a, b) => {
		if (a.net !== b.net) {
			return a.net - b.net;        // 1ìˆœìœ„: Net
		}
		return a.handicap - b.handicap; // 2ìˆœìœ„: í•¸ë”” (ì‘ì„ìˆ˜ë¡ ìƒìœ„)
	});

    validPlayers.forEach((p, i) => {
        let rankText = i + 1;
        if (i === 0) rankText = "ğŸ¥‡";
        if (i === 1) rankText = "ğŸ¥ˆ";
        if (i === 2) rankText = "ğŸ¥‰";

        p.row.cells[0].innerHTML = rankText;
        p.row.cells[6].textContent = p.net;

        if (i === 0) p.row.classList.add("rank-1");
        if (i === 1) p.row.classList.add("rank-2");
        if (i === 2) p.row.classList.add("rank-3");
    });

    // íŒ€ ìˆœìœ„
    const teamMap = {};
    validPlayers.forEach(p => {
        teamMap[p.team] = (teamMap[p.team] || 0) + p.net;
    });

    const teamBody = document.querySelector("#teamTable tbody");
    teamBody.innerHTML = Object.entries(teamMap)
        .sort((a,b)=>a[1]-b[1])
        .map((t,i)=>`
            <tr>
                <td>${i+1}</td>
                <td>${t[0]}</td>
                <td>${t[1]}</td>
            </tr>
        `).join("");
}
</script>

</body>
</html>
