<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì˜ì—­ ì˜ë¼ì„œ OCR</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
  body { text-align:center; font-family:Arial; }
  video { width:100%; max-width:400px; border-radius:10px; }
  button {
    padding:12px 20px;
    font-size:18px;
    margin-top:10px;
    background:#28a745;
    color:white;
    border:none;
    border-radius:8px;
  }
  .result { margin-top:15px; font-size:18px; }
</style>
</head>
<body>

<h2>ğŸ“· ê³ ì • ì˜ì—­ OCR</h2>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<br>
<button onclick="capture()">ğŸ“¸ ì¸ì‹í•˜ê¸°</button>

<div class="result">
  <p>PAR: <span id="parValue">-</span></p>
  <p>Gí•¸ë””: <span id="ghandiValue">-</span></p>
  <p>Total: <span id="totalValue">-</span></p>
</div>

<script>
const video = document.getElementById('video');

navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => video.srcObject = stream)
.catch(err => alert("ì¹´ë©”ë¼ ì˜¤ë¥˜: " + err));

function capture() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  // ğŸ”¥ ê³ ì • ì˜ì—­ ì¢Œí‘œ (ë¹„ìœ¨ ê¸°ì¤€)
  const w = canvas.width;
  const h = canvas.height;

  const parArea = ctx.getImageData(w*0.1, h*0.6, w*0.8, h*0.08);
  const ghandiArea = ctx.getImageData(w*0.1, h*0.7, w*0.8, h*0.08);
  const totalArea = ctx.getImageData(w*0.1, h*0.8, w*0.8, h*0.1);

  recognizeArea(parArea, "parValue", /(\d+)/);
  recognizeArea(ghandiArea, "ghandiValue", /(\d+)/);
  recognizeArea(totalArea, "totalValue", /(\d+)/);
}

function recognizeArea(imageData, elementId, regex) {
  const tempCanvas = document.createElement("canvas");
  tempCanvas.width = imageData.width;
  tempCanvas.height = imageData.height;
  tempCanvas.getContext("2d").putImageData(imageData, 0, 0);

  Tesseract.recognize(
    tempCanvas,
    'eng',
    {
      tessedit_char_whitelist: '0123456789'
    }
  ).then(({ data: { text } }) => {
    const clean = text.replace(/\s/g,'');
    const match = clean.match(regex);
    document.getElementById(elementId).innerText =
      match ? match[1] : "ì°¾ì„ ìˆ˜ ì—†ìŒ";
  });
}
</script>

</body>
</html>
