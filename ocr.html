<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê°€ì´ë“œ ë°•ìŠ¤ OCR</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
  body { margin:0; font-family:Arial; text-align:center; background:#111; color:white;}
  .camera-wrapper {
    position:relative;
    width:100%;
    max-width:400px;
    margin:auto;
  }
  video {
    width:100%;
    border-radius:12px;
  }
  .guide {
    position:absolute;
    left:10%;
    width:80%;
    border:3px solid #00ff88;
    border-radius:8px;
    box-sizing:border-box;
  }
  #parBox { top:60%; height:8%; }
  #ghandiBox { top:70%; height:8%; }
  #totalBox { top:80%; height:10%; border-color:#ffcc00; }

  button {
    margin-top:15px;
    padding:12px 20px;
    font-size:18px;
    background:#00c853;
    border:none;
    border-radius:8px;
    color:white;
  }

  .result { margin-top:15px; font-size:18px; }
</style>
</head>
<body>

<h3>ğŸ“· ê°€ì´ë“œ ë°•ìŠ¤ ë§ì¶°ì„œ ì¸ì‹</h3>

<div class="camera-wrapper">
  <video id="video" autoplay playsinline></video>

  <!-- ê°€ì´ë“œ ë°•ìŠ¤ -->
  <div id="parBox" class="guide"></div>
  <div id="ghandiBox" class="guide"></div>
  <div id="totalBox" class="guide"></div>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<button onclick="capture()">ğŸ“¸ ì¸ì‹í•˜ê¸°</button>

<div class="result">
  <p>PAR: <span id="parValue">-</span></p>
  <p>Gí•¸ë””: <span id="ghandiValue">-</span></p>
  <p>Total: <span id="totalValue">-</span></p>
</div>

<script>
const video = document.getElementById('video');

navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => video.srcObject = stream)
.catch(err => alert("ì¹´ë©”ë¼ ì˜¤ë¥˜: " + err));

function capture() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);

  const w = canvas.width;
  const h = canvas.height;

  // ê°€ì´ë“œ ë°•ìŠ¤ ìœ„ì¹˜ì™€ ë™ì¼í•œ ë¹„ìœ¨
  const areas = {
    par: ctx.getImageData(w*0.1, h*0.6, w*0.8, h*0.08),
    ghandi: ctx.getImageData(w*0.1, h*0.7, w*0.8, h*0.08),
    total: ctx.getImageData(w*0.1, h*0.8, w*0.8, h*0.1)
  };

  recognize(areas.par, "parValue");
  recognize(areas.ghandi, "ghandiValue");
  recognize(areas.total, "totalValue");
}

function recognize(imageData, elementId) {
  const tempCanvas = document.createElement("canvas");
  tempCanvas.width = imageData.width;
  tempCanvas.height = imageData.height;
  tempCanvas.getContext("2d").putImageData(imageData, 0, 0);

  Tesseract.recognize(
    tempCanvas,
    'eng',
    {
      tessedit_char_whitelist: '0123456789'
    }
  ).then(({ data: { text } }) => {
    const clean = text.replace(/\D/g,'');
    document.getElementById(elementId).innerText =
      clean.length ? clean : "ì°¾ì„ ìˆ˜ ì—†ìŒ";
  });
}
</script>

</body>
</html>
