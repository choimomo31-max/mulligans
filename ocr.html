<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëª¨ë°”ì¼ ì‹¤ì‹œê°„ OCR</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
  body { font-family: Arial; text-align: center; padding: 10px; }
  video, canvas { width: 100%; max-width: 400px; border-radius: 10px; }
  button {
    padding: 12px 20px;
    font-size: 18px;
    margin-top: 10px;
    border: none;
    background: #2c7be5;
    color: white;
    border-radius: 8px;
  }
  .result { margin-top: 15px; font-size: 18px; }
</style>
</head>
<body>

<h2>ğŸ“· PAR / Gí•¸ë”” / Total ì‹¤ì‹œê°„ ì¸ì‹</h2>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<br>
<button onclick="captureAndRecognize()">ğŸ“¸ ì¸ì‹í•˜ê¸°</button>

<div class="result">
  <p>PAR: <span id="parValue">-</span></p>
  <p>Gí•¸ë””: <span id="ghandiValue">-</span></p>
  <p>Total: <span id="totalValue">-</span></p>
</div>

<script>
const video = document.getElementById('video');

// ğŸ“· ì¹´ë©”ë¼ ì‹¤í–‰
navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => {
  video.srcObject = stream;
})
.catch(err => {
  alert("ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨: " + err);
});

function captureAndRecognize() {
  const canvas = document.getElementById('canvas');
  const context = canvas.getContext('2d');

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  context.drawImage(video, 0, 0, canvas.width, canvas.height);

  const imageData = canvas.toDataURL('image/png');

  Tesseract.recognize(
    imageData,
    'kor+eng',
    { logger: m => console.log(m) }
  ).then(({ data: { text } }) => {

    console.log("OCR ê²°ê³¼:", text);

    const parMatch = text.match(/PAR\s*[:\-]?\s*(\d+)/i);
    const ghandiMatch = text.match(/Gí•¸ë””\s*[:\-]?\s*(\d+)/i);
    const totalMatch = text.match(/Total\s*[:\-]?\s*(\d+)/i);

    document.getElementById('parValue').innerText = parMatch ? parMatch[1] : "ì°¾ì„ ìˆ˜ ì—†ìŒ";
    document.getElementById('ghandiValue').innerText = ghandiMatch ? ghandiMatch[1] : "ì°¾ì„ ìˆ˜ ì—†ìŒ";
    document.getElementById('totalValue').innerText = totalMatch ? totalMatch[1] : "ì°¾ì„ ìˆ˜ ì—†ìŒ";
  });
}
</script>

</body>
</html>
